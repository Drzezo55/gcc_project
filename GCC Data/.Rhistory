data = data,
risk.table = TRUE,        # add number at risk below plot
pval = TRUE,              # show p-value (log-rank test)
conf.int = TRUE,          # show confidence intervals
legend.title = "Treatment",
xlab = "Time",
ylab = "Progression-free Survival"
)
library(readxl)
df <- read_excel("SEER_project/data/data.xlsx")
View(df)
library(here)
library(dplyr)
library(tidyverse)
library(readxl)
df <- read_excel("data/data.xlsx")
here()
library(here)
library(dplyr)
library(tidyverse)
library(readxl)
here()
here()
df <- load(file.choose(new = TRUE))
df <- load(file.choose(new = FALSE))
library(readxl)
df <- read_excel("Desktop/Outcome.xlsx")
df
madad(df)
library("mada")
install.packages("madad")
install.packages("remotes")
remotes::install_github("epicentre/madad")
install.packages("mada")
library("mada")
df <- read_excel("Desktop/Outcome.xlsx")
madad(df)
df <- read_excel("Desktop/Outcome.xlsx")
madad(df)
meta <- madad(df)
forest(meta, type = "sens")
forest(meta, type = "spec")
help("forest")
help(madad)
install.packages("diagmeta")
library(diagmeta)
diagmeta(
TP,
FP,
TN,
FN,
studlab = names,
data = NULL,
distr = "logistic",
model = "CICS",
equalvar = FALSE,
lambda = 0.5,
log.cutoff = FALSE,
method.weights = "invvar",
level = 0.95,
incr = 0.5,
n.iter.max = 1000,
tol = 1e-08,
silent = TRUE,
)
df <- read_excel("Desktop/Outcome.xlsx")
df
diagmeta(
TP = TP,
FP = FP,
TN = TN,
FN = FN,
studlab = names,
data = df,
distr = "logistic",
model = "CICS",
equalvar = FALSE,
lambda = 0.5,
log.cutoff = FALSE,
method.weights = "invvar",
level = 0.95,
incr = 0.5,
n.iter.max = 1000,
tol = 1e-08,
silent = TRUE,
)
diagmeta(
TP = TP,
FP = FP,
TN = TN,
FN = FN,
studlab = names,
data = df,
cutoff = NULL,
distr = "logistic",
model = "CICS",
equalvar = FALSE,
lambda = 0.5,
log.cutoff = FALSE,
method.weights = "invvar",
level = 0.95,
incr = 0.5,
n.iter.max = 1000,
tol = 1e-08,
silent = TRUE,
)
library(mada)
model <- reitsma(TP, FN, FP, TN, data = df)
TP <- df$TP
TN <- df$TN
FP <- df$FP
FN <- df$FN
model <- reitsma(TP, FN, FP, TN, data = df)
model <- reitsma(cbind(TP, FN, FP, TN) ~ 1, data = df)
summary(model)
plot(model)
mada.sens(model)
library(mada)
# Assuming your data is df with TP, FP, TN, FN columns
df$sens <- df$TP / (df$TP + df$FN)
df$spec <- df$TN / (df$TN + df$FP)
plot(
df$spec,
df$sens,
xlab = "Specificity",
ylab = "Sensitivity",
pch = 19,
main = "Sensitivity vs Specificity"
)
grid()
model <- reitsma(cbind(TP, FN, FP, TN) ~ 1, data = df)
plot(model,
main = "SROC Curve with Study Points",
xlab = "1 - Specificity",
ylab = "Sensitivity")
forest(model, type = "sens")
m <- mada(df)
library(mada)
m <- mada(df)
m <- mada::mada(df)
library(mada)
m <- madad(df)
forest(m, type = "sens")   # Forest plot of sensitivities
meta <- madad(df)
meta
meta <- madad(df, level = 0.95)
meta
forest(meta, type = "sens")
mada:::forest.madad(meta, type = "sens")
mada:::forest.madad(meta, type = "spec")
mada.sens(model)
library(mada)
model <- reitsma(cbind(TP, FN, FP, TN) ~ 1, data = df)
mada.sens(model)
mada:::forest.madad(meta, type = "sens")
meta$sens.htest
rs <- rowSums(df)
rs <- rowSums(df[,c(2,3,4,5)])
rs
weights <- 4 * rs / max(rs)
crosshair(AuditC, xlim = c(0,0.6), ylim = c(0.4,1),
col = 1:14, lwd = weights)
crosshair(df, xlim = c(0,0.6), ylim = c(0.4,1),
col = 1:14, lwd = weights)
mada:::forest.madad(meta, type = "sens")
mada:::forest.madad(meta, type = "spec")
(fit.DOR.DSL <- madauni(df))
(fit.DOR.MH <- madauni(df, method = "MH"))
summary(fit.DOR.DSL)
forest(fit.DOR.DSL)
forest(fit.DOR.DSL)
mada:::forest.madauni(fit.DOR.DSL)
mada:::forest.madauni(fit.DOR.MH)
(fit.reitsma <- reitsma(df))
summary(fit.reitsma)
(fit.phm.homo <- phm(df, hetero = FALSE))
summary(fit.reitsma)
(fit.phm.het <- phm(df))
summary(fit.phm.homo)
summary(fit.phm.het)
plot(fit.phm.het, xlim = c(0,0.6), ylim = c(0.4,1))
plot(fit.phm.homo, xlim = c(0,0.6), ylim = c(0.4,1))
ROCellipse(df, add = TRUE)
help(madauni)
summary(fit.DOR.DSL)
summary(fit.DOR.MH)
(fit.DOR.DSL <- madauni(df, method = "DSL"))
summary(fit.DOR.DSL)
(fit.DOR.MH <- madauni(df, method = "MH"))
summary(fit.DOR.MH)
fit.DOR.MH$descr
fit.DOR.MH$tau_sq
mada:::forest.phm(fit.DOR.DSL)
mada:::forest(fit.DOR.DSL)
mada:::forest(fit.phm.homo)
mada:::forest(fit.phm.het)
mada:::forest.madauni(fit.DOR.MH)
mada:::forest.madauni(fit.DOR.DSL)
mada:::forest.madauni(fit.DOR.MH)
mada:::forest.madauni(fit.DOR.DSL)
mada:::forest.madauni(fit.DOR.MH)
mada:::forest.madauni(fit.DOR.DSL)
ROCellipse(df, pch = "")
points(fpr(df), sens(df))
rs <- rowSums(df[,c(2,3,4,5)])
weights <- 4 * rs / max(rs)
crosshair(df, xlim = c(0,0.6), ylim = c(0.4,1),
col = 1:14, lwd = weights)
ROCellipse(df, pch = "")
points(fpr(df), sens(df))
table(df)
df
summary(fit.phm.homo)
summary(fit.phm.het)
library(ggplot2)
df_plot <- data.frame(
study = rownames(df),
sens = preds$TPR,
lower = preds$TPR.LCL,
upper = preds$TPR.UCL
)
preds <- predict(fit.phm.het)  # or fit.phm.homo
summary(fit.phm.het)
summary(fit.phm.homo)
# Load required library
library(ggplot2)
# Example: study-level data
# Replace these with your actual study-level sensitivity and specificity estimates
df_plot <- data.frame(
study = c("Noh 2020", "Noh 2024", "Soh 2023", "Yoshikawa 2024"),
sens  = c(0.941, 0.812, 0.980, 0.933),
sens_low  = c(0.898, 0.704, 0.895, 0.786),
sens_high = c(0.967, 0.887, 0.996, 0.981),
spec  = c(0.826, 0.912, 0.100, 0.922),
spec_low  = c(0.736, 0.855, 0.053, 0.830),
spec_high = c(0.890, 0.948, 0.180, 0.966)
)
# Pooled effects from PHM
pooled_sens <- 0.967   # example: pooled AUC as proxy for sensitivity
pooled_spec <- 0.967   # same for specificity
# Forest plot for Sensitivity
p1 <- ggplot(df_plot, aes(x = sens, y = reorder(study, sens))) +
geom_point(color = "blue", size = 3) +
geom_errorbarh(aes(xmin = sens_low, xmax = sens_high), height = 0.2, color = "blue") +
geom_vline(xintercept = pooled_sens, linetype = "dashed", color = "red", size = 1) +
theme_minimal() +
xlab("Sensitivity") +
ylab("") +
ggtitle("Forest plot of Sensitivity with pooled effect (red line)")
# Forest plot for Specificity
p2 <- ggplot(df_plot, aes(x = spec, y = reorder(study, spec))) +
geom_point(color = "darkgreen", size = 3) +
geom_errorbarh(aes(xmin = spec_low, xmax = spec_high), height = 0.2, color = "darkgreen") +
geom_vline(xintercept = pooled_spec, linetype = "dashed", color = "red", size = 1) +
theme_minimal() +
xlab("Specificity") +
ylab("") +
ggtitle("Forest plot of Specificity with pooled effect (red line)")
print(p1)
print(p2)
print(p1)
fit.phm.homo$hetero
fit.phm.homo$estimator
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(mada)
library(readxl)
library(mada)
### load your data and create the madad object with 95% CI
meta <- madad(df, level = 0.95)
df <- read_excel("Desktop/Outcome.xlsx")
mada:::forest.madad(meta, type = "sens")
mada:::forest.madad(meta, type = "spec")
rs <- rowSums(df[,c(2,3,4,5)])
weights <- 4 * rs / max(rs)
crosshair(df, xlim = c(0,0.6), ylim = c(0.4,1),
col = 1:14, lwd = weights)
ROCellipse(df, pch = "")
points(fpr(df), sens(df))
### Diagnostic odds ratio approach with DerSimonian and Laird (random effects)
(fit.DOR.DSL <- madauni(df, method = "DSL"))
summary(fit.DOR.DSL)
# For DSL method
mada:::forest.madauni(fit.DOR.DSL)
### Diagnostic odds ratio approach with Mantel-Haenszel (fixed effects)
(fit.DOR.MH <- madauni(df, method = "MH"))
summary(fit.DOR.MH)
# For MH method
mada:::forest.madauni(fit.DOR.MH)
### Proportional hazards model approach
(fit.phm.homo <- phm(df, hetero = FALSE))
(fit.phm.het <- phm(df))
summary(fit.phm.homo)
summary(fit.phm.het)
plot(fit.phm.het, xlim = c(0,0.6), ylim = c(0.4,1))
ROCellipse(df, add = TRUE)
install.packages("tinytex")
install.packages("tinytex")
### load your data and create the madad object with 95% CI
setwd("~/Desktop/swab")      # macOS/Linux
df <- read_excel("Outcome.xlsx")
meta <- madad(df, level = 0.95)
install.packages("tinytex")
install.packages("tinytex")
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(mada)
### load your data and create the madad object with 95% CI
setwd("~/Desktop/swab")      # macOS/Linux
df <- read_excel("Outcome.xlsx")
meta <- madad(df, level = 0.95)
tinytex::pdflatex()
install.packages("tinytex")      # if not installed
install.packages("tinytex")
tinytex::tinytex_root()    # shows where TinyTeX is installed
tinytex::latexmk("test.tex")
# Install the LaTeX distribution (this can take a few minutes)
tinytex::install_tinytex()
knitr::opts_chunk$set(echo = TRUE)
### load your data and create the madad object with 95% CI
setwd("~/Desktop/swab")
df <- read_excel("Outcome.xlsx")
library(readxl)
library(mada)
### load your data and create the madad object with 95% CI
setwd("~/Desktop/swab")
df <- read_excel("Outcome.xlsx")
meta <- madad(df, level = 0.95)
### load your data and create the madad object with 95% CI
setwd("~/Desktop/swab")
df <- read_excel("Outcome.xlsx")
meta <- madad(df, level = 0.95)
mada:::forest.madad(meta, type = "sens")
mada:::forest.madad(meta, type = "spec")
rs <- rowSums(df[,c(2,3,4,5)])
weights <- 4 * rs / max(rs)
crosshair(df, xlim = c(0,0.6), ylim = c(0.4,1),
col = 1:14, lwd = weights)
ROCellipse(df, pch = "")
points(fpr(df), sens(df))
library(mada)
# Original DSL
fit.DOR.DSL <- madauni(df, method = "DSL")
summary(fit.DOR.DSL)
# Leave-one-out sensitivity
loo_results <- sapply(1:nrow(df), function(i) {
temp_df <- df[-i, ]   # remove study i
fit <- madauni(temp_df, method = "DSL")
fit$DOR
})
names(loo_results) <- df$study  # optional: add study names
loo_results
library(mada)
# Original DSL
fit.DOR.DSL <- madauni(df, method = "DSL")
summary(fit.DOR.DSL)
# Leave-one-out sensitivity
loo_results <- sapply(1:nrow(df), function(i) {
temp_df <- df[-i, ]   # remove study i
fit <- madauni(temp_df, method = "DSL")
fit$DOR
})
names(loo_results) <- df$names  # optional: add study names
loo_results
loo_DSL <- sapply(1:nrow(df), function(i) {
temp <- df[-i, ]
fit <- madauni(temp, method = "DSL")
fit$DOR
})
names(loo_DSL) <- df$study
loo_DSL
loo_DSL <- sapply(1:nrow(df), function(i) {
temp <- df[-i, ]
fit <- madauni(temp, method = "DSL")
fit$DOR
})
names(loo_DSL) <- df$names
loo_DSL
# Example: compute DOR and log DOR per study
df$DOR <- (df$TP * df$TN) / (df$FP * df$FN)
df$lnDOR <- log(df$DOR)
loo_DSL <- sapply(1:nrow(df), function(i) {
temp <- df[-i, ]
fit <- madauni(temp, method = "DSL")
fit$DOR
})
names(loo_DSL) <- df$names
loo_DSL
# Example: compute DOR and log DOR per study
df$DOR <- (df$TP * df$TN) / (df$FP * df$FN)
df$lnDOR <- log(df$DOR)
loo_DSL <- sapply(1:nrow(df), function(i) {
temp <- df[-i, ]
fit <- madauni(temp, method = "DSL")
fit$DOR
})
names(loo_DSL) <- df$names
loo_DSL
# Example: compute DOR and log DOR per study
df$DOR <- (df$TP * df$TN) / (df$FP * df$FN)
df$lnDOR <- log(df$DOR)
loo_DSL <- sapply(1:nrow(df), function(i) {
temp <- df[-i, ]
fit <- madauni(temp, method = "DSL")
fit$DOR
})
names(loo_DSL) <- df$names
loo_DSL
df$DOR <- (df$TP * df$TN) / (df$FP * df$FN)  # study-level DOR
df$lnDOR <- log(df$DOR)                       # log DOR
df
df$DOR <- (df$TP * df$TN) / (df$FP * df$FN)  # study-level DOR
df$lnDOR <- log(df$DOR)                       # log DOR
df
loo_DSL <- sapply(1:nrow(df), function(i) {
temp <- df[-i, ]                # remove study i
fit <- madauni(temp, method="DSL")
fit$DOR                        # pooled DOR without study i
})
names(loo_DSL) <- df$study
loo_DSL
setwd("~/GCC/GCC Data")
library(tidyverse)
file <- "~/GCC/GCC Data/Bahrain/CSV/BAHRAIN2002.csv"
bahrain_2002 <- read_csv(file, show_col_types = FALSE)
glimpse(bahrain_2002)
names(bahrain_2002)
bahrain_2002 <- read_csv(
"~/GCC/GCC Data/Bahrain/CSV/BAHRAIN2002.csv",
show_col_types = FALSE
) |> mutate(country = "Bahrain", year = 2002)
bahrain_2015 <- read_csv(
"~/GCC/GCC Data/Bahrain/CSV/BAHRAIN2015.csv",
show_col_types = FALSE
) |> mutate(country = "Bahrain", year = 2015)
kuwait_2001 <- read_csv(
"~/GCC/GCC Data/Kuwait/CSV/KUWAIT 2001.csv",
show_col_types = FALSE
) |> mutate(country = "Kuwait", year = 2001)
kuwait_2005 <- read_csv(
"~/GCC/GCC Data/Kuwait/CSV/KUWAIT2005.csv",
show_col_types = FALSE
) |> mutate(country = "Kuwait", year = 2005)
kuwait_2009 <- read_csv(
"~/GCC/GCC Data/Kuwait/CSV/KUWAIT2009.csv",
show_col_types = FALSE
) |> mutate(country = "Kuwait", year = 2009)
kuwait_2016 <- read_csv(
"~/GCC/GCC Data/Kuwait/CSV/KUWAIT2016.csv",
show_col_types = FALSE
) |> mutate(country = "Kuwait", year = 2016)
oman_2002 <- read_csv(
"~/GCC/GCC Data/Oman/CSV/OMAN2002.csv",
show_col_types = FALSE
) |> mutate(country = "Oman", year = 2002)
oman_2007 <- read_csv(
"~/GCC/GCC Data/Oman/CSV/OMAN2007.csv",
show_col_types = FALSE
) |> mutate(country = "Oman", year = 2007)
oman_2010 <- read_csv(
"~/GCC/GCC Data/Oman/CSV/OMAN2010.csv",
show_col_types = FALSE
) |> mutate(country = "Oman", year = 2010)
oman_2016 <- read_csv(
"~/GCC/GCC Data/Oman/CSV/OMAN2016.csv",
show_col_types = FALSE
) |> mutate(country = "Oman", year = 2016)
# Qatar
qatar_2004 <- read_csv(
"~/GCC/GCC Data/Qatar/CSV/QATAR2004.csv",
show_col_types = FALSE
) |> mutate(country = "Qatar", year = 2004)
qatar_2007 <- read_csv(
"~/GCC/GCC Data/Qatar/CSV/QATAR2007.csv",
show_col_types = FALSE
) |> mutate(country = "Qatar", year = 2007)
qatar_2013 <- read_csv(
"~/GCC/GCC Data/Qatar/CSV/QATAR2013.csv",
show_col_types = FALSE
) |> mutate(country = "Qatar", year = 2013)
qatar_2018 <- read_csv(
"~/GCC/GCC Data/Qatar/CSV/QATAR2018.csv",
show_col_types = FALSE
) |> mutate(country = "Qatar", year = 2018)
saudi_2001 <- read_csv(
"~/GCC/GCC Data/Saudi/CSV/SAU2001.csv",
show_col_types = FALSE
) |> mutate(country = "Saudi Arabia", year = 2001)
saudi_2007 <- read_csv(
"~/GCC/GCC Data/Saudi/CSV/SAU2007.csv",
show_col_types = FALSE
) |> mutate(country = "Saudi Arabia", year = 2007)
saudi_2010 <- read_csv(
"~/GCC/GCC Data/Saudi/CSV/SAU2010.csv",
show_col_types = FALSE
) |> mutate(country = "Saudi Arabia", year = 2010)
saudi_2022 <- read_csv(
"~/GCC/GCC Data/Saudi/CSV/SAU2022.csv",
show_col_types = FALSE
) |> mutate(country = "Saudi Arabia", year = 2022)
uae_2002 <- read_csv(
"~/GCC/GCC Data/UAE/CSV/UNITEDARABEMIRATES2002.csv",
show_col_types = FALSE
) |> mutate(country = "UAE", year = 2002)
uae_2005 <- read_csv(
"~/GCC/GCC Data/UAE/CSV/UNITEDARABEMIRATES2005.csv",
show_col_types = FALSE
) |> mutate(country = "UAE", year = 2005)
uae_2013 <- read_csv(
"~/GCC/GCC Data/UAE/CSV/UNITEDARABEMIRATES2013.csv",
show_col_types = FALSE
) |> mutate(country = "UAE", year = 2013)
